<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>รายชื่อผู้ใช้</title>
</head>
<body>
    <h1>รายชื่อผู้ใช้ในระบบ</h1>
    <p id="status">กำลังโหลด...</p>

    <table id="user-table" border="1" style="display:none; border-collapse: collapse; width:100%;">
        <thead>
            <tr style="background-color: #eee;">
                <th>รูป</th>
                <th>User ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Birth Date</th>
                <th>ที่อยู่</th>
                <th>Rating</th>
                <th>Favorite</th>
                <th>Wishlist</th>
                <th>Comments</th>
            </tr>
        </thead>
        <tbody id="user-body"></tbody>
    </table>

    <script>
        async function fetchAllUsers() {
            try {
                const response = await fetch('http://localhost:5000/api/users');
                const users = await response.json();
                const tbody = document.getElementById('user-body');

                users.forEach(u => {
                    const row = document.createElement('tr');

                    row.innerHTML = `
                        <td>
                            ${u.user_image 
                                ? `<img src="${u.user_image}" width="60">`
                                : ''
                            }
                        </td>

                        <td>${u.user_id}</td>
                        <td><b>${u.username}</b></td>
                        <td>${u.email}</td>
                        <td>${u.birth_date ?? ''}</td>
                        <td>${u.location ?? ''}</td>

                        <td>
                            ${u.rated_books?.length
                                ? u.rated_books.join('<br>')
                                : ''
                            }
                        </td>

                        <td align="center">
                            ${u.favorite_books?.length
                                ? u.favorite_books.join('<br>')
                                : ''
                            }
                        </td>

                        <td align="center">
                            ${u.wishlist_books?.length
                                ? u.wishlist_books.join('<br>')
                                : ''
                            }
                        </td>

                        <td>
                            ${u.comments?.length
                                ? u.comments.map(c =>
                                    `<div><b>${c.book_title}</b>: ${c.comment}</div>`
                                ).join('')
                                : ''
                            }
                        </td>
                    `;

                    tbody.appendChild(row);
                });

                document.getElementById('status').style.display = 'none';
                document.getElementById('user-table').style.display = 'table';

            } catch (error) {
                document.getElementById('status').innerText = 'Error: ' + error;
            }
        }

        fetchAllUsers();
    </script>
</body>
</html>
